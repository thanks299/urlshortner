# SNIP â€” URL Shortener

> Production-grade URL shortener built with the **Scrum framework**, using **Node.js**, **Express**, and **MongoDB**.

---

## Architecture

This project follows a strict **layered architecture** for maintainability and testability:

```
HTTP Request
     â”‚
     â–¼
 Middleware           (helmet, cors, rate-limiter, morgan)
     â”‚
     â–¼
   Routes             (routes/api.js, routes/redirect.js)
     â”‚
     â–¼
 Validators           (validators/linkValidator.js)
     â”‚
     â–¼
 Controllers          (controllers/linkController.js)
     â”‚
     â–¼
  Services            (services/linkService.js)       â† Business Logic
     â”‚
     â–¼
 Repositories         (repositories/linkRepository.js) â† Data Access
     â”‚
     â–¼
   Models             (models/Link.js)                â† Mongoose Schema
     â”‚
     â–¼
  MongoDB
```

Each layer has a single responsibility. Tests mock the layer below â€” services test with a mocked repo; controllers test with a mocked service.

---

## Project Structure

```
snip/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js                          # Entry point â€” bootstrap, middleware, routes
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js                 # MongoDB connection (Mongoose)
â”‚   â”‚   â””â”€â”€ logger.js                   # Winston logger (dev + prod formats)
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ Link.js                     # Mongoose schema: Link + ClickEvent sub-doc
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ linkRepository.js           # ALL MongoDB queries â€” no logic
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ linkService.js              # Business logic: shorten, resolve, analytics
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ linkController.js           # REST API controllers
â”‚   â”‚   â””â”€â”€ redirectController.js       # /:code redirect + HTML error pages
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ api.js                      # /api/* routes
â”‚   â”‚   â””â”€â”€ redirect.js                 # / and /:code routes
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”œâ”€â”€ rateLimiter.js              # express-rate-limit (100 req/15min)
â”‚   â”‚   â”œâ”€â”€ errorHandler.js             # Global error handler (Mongo + AppError)
â”‚   â”‚   â””â”€â”€ notFound.js                 # 404 catch-all
â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â””â”€â”€ linkValidator.js            # Request body validation middleware
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ AppError.js                 # Custom operational error class
â”‚   â”‚   â””â”€â”€ catchAsync.js               # Async error forwarding wrapper
â”‚   â””â”€â”€ public/
â”‚       â””â”€â”€ index.html                  # Frontend SPA (3 tabs: Shorten/Dashboard/API)
â”‚
â”œâ”€â”€ __tests__/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ linkService.test.js         # Service unit tests (repo fully mocked)
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ api.test.js                 # API integration tests (supertest)
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ scrum/
â”‚       â”œâ”€â”€ PRODUCT_BACKLOG.md          # Epics, user stories, story points
â”‚       â””â”€â”€ SPRINT_PLANNING.md          # Sprint 1â€“4 plans, velocity, retro notes
â”‚
â”œâ”€â”€ .env.example                        # Environment variable template
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## Scrum Framework

### Ceremonies
| Ceremony | Cadence | Purpose |
|----------|---------|---------|
| **Sprint Planning** | Start of each 2-week sprint | Select backlog items, estimate, assign |
| **Daily Standup** | Daily, 15 min | What I did / doing / blocked on |
| **Sprint Review** | End of sprint | Demo working software to stakeholders |
| **Retrospective** | End of sprint | Improve team process |

### Artifacts
| Artifact | Location |
|----------|----------|
| Product Backlog | `docs/scrum/PRODUCT_BACKLOG.md` |
| Sprint Plans | `docs/scrum/SPRINT_PLANNING.md` |
| Increment | This codebase |

### Sprints Completed
- **Sprint 1** â€” Core shortening, redirect, error handling âœ…
- **Sprint 2** â€” Analytics, expiry, dashboard, delete âœ…
- **Sprint 3** â€” Auth (JWT, users) ğŸ”² Planned
- **Sprint 4** â€” Redis cache, Docker, CI/CD ğŸ”² Planned

---

## Getting Started

### Prerequisites
- Node.js â‰¥ 18
- MongoDB (local or Atlas)

### Installation
```bash
git clone <repo>
cd snip
npm install
cp .env.example .env   # edit MONGO_URI
npm run dev            # nodemon â€” auto-restarts on changes
```

Open **http://localhost:3000**

### Environment Variables
| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `3000` | HTTP port |
| `MONGO_URI` | `mongodb://localhost:27017/snip` | MongoDB connection string |
| `BASE_URL` | `http://localhost:3000` | Used to build short URLs |
| `CODE_LENGTH` | `7` | Auto-generated code length |
| `RATE_LIMIT_MAX` | `100` | Max requests per window |
| `RATE_LIMIT_WINDOW_MS` | `900000` | Rate limit window (15 min) |

---

## REST API

### `POST /api/links` â€” Shorten a URL
```json
// Request body
{ "originalUrl": "https://...", "customCode": "my-slug", "expiresAt": "2025-12-31T23:59" }

// Response 201
{ "success": true, "data": { "shortCode": "my-slug", "shortUrl": "http://localhost:3000/my-slug", ... } }
```

### `GET /api/links` â€” List all links
Query params: `?page=1&limit=50&sortBy=clicks&order=desc`

### `GET /api/links/:code/analytics` â€” Click analytics
Returns per-click log (timestamp, IP, user-agent, referer).

### `DELETE /api/links/:code` â€” Delete a link (soft delete)

### `GET /:code` â€” Redirect
Returns 302 redirect, or styled 404/410 HTML page.

### `GET /api/health` â€” Health check

---

## Running Tests
```bash
npm test              # all tests
npm run test:watch    # watch mode
npm run test:cov      # with coverage report
```

Unit tests mock the repository layer â€” no MongoDB needed.
Integration tests require MongoDB (or use `@shelf/jest-mongodb` in-memory server).

---

## Scalability Roadmap (Sprint 3+)
- **Auth**: JWT-based user accounts, private links
- **Redis**: Cache hot short codes for sub-10ms redirects
- **Docker**: `docker-compose up` for app + mongo + redis
- **CI/CD**: GitHub Actions â†’ lint â†’ test â†’ deploy
- **Move clickEvents**: Separate `click_events` collection for high-traffic links
- **QR codes**: Generate QR per link
- **Link previews**: `/preview/:code` page before redirect